services:
  caddy:
    build: .
    container_name: caddy
    stop_grace_period: 1m
    restart: unless-stopped
    user: "1001"
    ports:
      - 443:443
      - 80:80
    volumes:
      - ./Caddyfile:/etc/caddy/Caddyfile
      - caddy_data:/data
      - nextcloud_site:/php-fpm-root/nextcloud/
      - /var/lib/geoip/GeoLite2-Country.mmdb:/data/GeoLite2-Country.mmdb:ro
    networks:
      - audiobookshelf
      - frontend
      - monitoring
      - immich
      - internal
      - nextcloud
      - navidrome
      - watchtower

volumes:
  caddy_data:
    external: true
  # Required because caddy is being a php_fastcgi proxy to
  # Nextcloud. Therefore, it needs access to all static files
  nextcloud_site:
    external: true

networks:
  audiobookshelf:
    external: true
  frontend:
    external: true
  nextcloud:
    external: true
  immich:
    external: true
  internal:
    external: true
  navidrome:
    external: true
  monitoring:
    external: true
  watchtower:
    external: true
